(function(a){a(window.CodeMirror=window.CodeMirror||{})})(function(a){"use strict";function b(a,b,d){var c=a.docs[b];c?d(F(a,c)):a.options.getFile?a.options.getFile(b,d):d(null)}function d(a,b,c){for(var d in a.docs){var e=a.docs[d];if(e.doc==b)return e}if(!c)for(var f=0;;++f)if(d="[doc"+(f||"")+"]",!a.docs[d]){c=d;break}return a.addDoc(c,b)}function c(b,c){return"string"==typeof c?b.docs[c]:(c instanceof a&&(c=c.getDoc()),c instanceof a.Doc)?d(b,c):void 0}function e(a,b,c){var e=d(a,b),g=a.cachedArgHints;g&&g.doc==b&&0<=M(g.start,c.to)&&(a.cachedArgHints=null);var h=e.changed;null==h&&(e.changed=h={from:c.from.line,to:c.from.line});var i=c.from.line+(c.text.length-1);c.from.line<h.to&&(h.to-=c.to.line-i),i>=h.to&&(h.to=i+1),h.from>c.from.line&&(h.from=c.from.line),b.lineCount()>K&&100<c.to-h.from&&setTimeout(function(){e.changed&&100<e.changed.to-e.changed.from&&f(a,e)},200)}function f(a,b){a.server.request({files:[{type:"full",name:b.name,text:F(a,b)}]},function(a){a?window.console.error(a):b.changed=null})}function g(b,d,e){b.request(d,{type:"completions",types:!0,docs:!0,urls:!0},function(c,f){if(c)return D(b,d,c);var g=[],j="",k=f.start,l=f.end;"[\""==d.getRange(I(k.line,k.ch-2),k)&&"\"]"!=d.getRange(l,I(l.line,l.ch+2))&&(j="\"]");for(var m=0;m<f.completions.length;++m){var i=f.completions[m],n=h(i.type);f.guess&&(n+=" "+J+"guess"),g.push({text:i.name+j,displayText:i.displayName||i.name,className:n,data:i})}var o={from:k,to:l,list:g},p=null;a.on(o,"close",function(){B(p)}),a.on(o,"update",function(){B(p)}),a.on(o,"select",function(a,c){B(p);var d=b.options.completionTip?b.options.completionTip(a.data):a.data.doc;d&&(p=A(c.parentNode.getBoundingClientRect().right+window.pageXOffset,c.getBoundingClientRect().top+window.pageYOffset,d),p.className+=" "+J+"hint-doc")}),e(o)})}function h(a){var b;return b="?"==a?"unknown":"number"==a||"string"==a||"bool"==a?a:/^fn\(/.test(a)?"fn":/^\[/.test(a)?"array":"object",J+"completion "+J+"completion-"+b}function i(a,b,d,e,f){a.request(b,e,function(c,d){if(c)return D(a,b,c);if(a.options.typeTip)var e=a.options.typeTip(d);else{var e=w("span",null,w("strong",null,d.type||"not found"));if(d.doc&&e.appendChild(document.createTextNode(" \u2014 "+d.doc)),d.url){e.appendChild(document.createTextNode(" "));var g=e.appendChild(w("a",null,"[docs]"));g.href=d.url,g.target="_blank"}}y(b,e,a),f&&f()},d)}function j(b,c){if(E(b),!c.somethingSelected()){var d=c.getTokenAt(c.getCursor()).state,f=a.innerMode(c.getMode(),d);if("javascript"==f.mode.name){var g=f.state.lexical;if("call"==g.info){for(var h,i=g.pos||0,j=c.getOption("tabSize"),m=c.getCursor().line,n=H(0,m-9),e=!1;m>=n;--m){for(var o,p=c.getLine(m),q=0,r=0;;){if(o=p.indexOf("\t",r),-1==o)break;q+=j-(o+q)%j-1,r=o+1}if(h=g.column-q,"("==p.charAt(h)){e=!0;break}}if(e){var s=I(m,h),t=b.cachedArgHints;return t&&t.doc==c.getDoc()&&0==M(s,t.start)?k(b,c,i):void b.request(c,{type:"type",preferFunction:!0,end:s},function(a,d){!a&&d.type&&/^fn\(/.test(d.type)&&(b.cachedArgHints={start:s,type:l(d.type),name:d.exprName||d.name||"fn",guess:d.guess,doc:c.getDoc()},k(b,c,i))})}}}}}function k(a,b,c){E(a);for(var d=a.cachedArgHints,e=d.type,f=w("span",d.guess?J+"fhint-guess":null,w("span",J+"fname",d.name),"("),g=0;g<e.args.length;++g){g&&f.appendChild(document.createTextNode(", "));var h=e.args[g];f.appendChild(w("span",J+"farg"+(g==c?" "+J+"farg-current":""),h.name||"?")),"?"!=h.type&&(f.appendChild(document.createTextNode(":\xA0")),f.appendChild(w("span",J+"type",h.type)))}f.appendChild(document.createTextNode(e.rettype?") ->\xA0":")")),e.rettype&&f.appendChild(w("span",J+"type",e.rettype));var i=b.cursorCoords(null,"page"),j=a.activeArgHints=A(i.right+1,i.bottom,f);setTimeout(function(){j.clear=z(b,function(){a.activeArgHints==j&&E(a)})},20)}function l(a){function b(b){for(var c=0,e=d;;){var f=a.charAt(d);if(b.test(f)&&!c)return a.slice(e,d);/[{\[\(]/.test(f)?++c:/[}\]\)]/.test(f)&&--c,++d}}var c=[],d=3;if(")"!=a.charAt(d))for(;;){var e=a.slice(d).match(/^([^, \(\[\{]+): /);if(e&&(d+=e[0].length,e=e[1]),c.push({name:e,type:b(/[\),]/)}),")"==a.charAt(d))break;d+=2}var f=a.slice(d).match(/^\) -> (.*)$/);return{args:c,rettype:f&&f[1]}}function m(a,b){function c(c){var e=d(a,b.getDoc());a.server.request(u(a,e,{type:"definition",variable:c||null}),function(c,d){if(c)return D(a,b,c);if(!d.file&&d.url)return void window.open(d.url);if(d.file){var f,g=a.docs[d.file];if(g&&(f=p(g.doc,d)))return a.jumpStack.push({file:e.name,start:b.getCursor("from"),end:b.getCursor("to")}),void o(a,e,g,f.start,f.end)}D(a,b,"Could not find a definition.")})}q(b)?c():x(b,"Jump to variable",function(a){a&&c(a)})}function n(a,b){var c=a.jumpStack.pop(),e=c&&a.docs[c.file];e&&o(a,d(a,b.getDoc()),e,c.start,c.end)}function o(a,b,c,d,e){c.doc.setSelection(d,e),b!=c&&a.options.switchToDoc&&(E(a),a.options.switchToDoc(c.name,c.doc))}function p(a,b){for(var c=Math.abs,d=b.context.slice(0,b.contextOffset).split("\n"),e=b.start.line-(d.length-1),f=I(e,(1==d.length?b.start.ch:a.getLine(e).length)-d[0].length),g=a.getLine(e).slice(f.ch),h=e+1;h<a.lineCount()&&g.length<b.context.length;++h)g+="\n"+a.getLine(h);if(g.slice(0,b.context.length)==b.context)return b;for(var i,j=a.getSearchCursor(b.context,0,!1),k=Infinity;j.findNext();){var l=j.from(),m=1e4*c(l.line-f.line);m||(m=c(l.ch-f.ch)),m<k&&(i=l,k=m)}if(!i)return null;if(1==d.length?i.ch+=d[0].length:i=I(i.line+(d.length-1),d[d.length-1].length),b.start.line==b.end.line)var n=I(i.line,i.ch+(b.end.ch-b.start.ch));else var n=I(i.line+(b.end.line-b.start.line),b.end.ch);return{start:i,end:n}}function q(a){var b=a.getCursor("end"),c=a.getTokenAt(b);return c.start<b.ch&&"comment"==c.type?!1:/[\w)\]]/.test(a.getLine(b.line).slice(H(b.ch-1,0),b.ch+1))}function r(a,b){var c=b.getTokenAt(b.getCursor());return /\w/.test(c.string)?void x(b,"New name for "+c.string,function(c){a.request(b,{type:"rename",newName:c,fullDocs:!0},function(c,d){return c?D(a,b,c):void t(a,d.changes)})}):D(a,b,"Not at a variable")}function s(a,b){var c=d(a,b.doc).name;a.request(b,{type:"refs"},function(d,e){if(d)return D(a,b,d);for(var f,g=[],h=0,j=b.getCursor(),k=0;k<e.refs.length;k++)f=e.refs[k],f.file==c&&(g.push({anchor:f.start,head:f.end}),0<=M(j,f.start)&&0>=M(j,f.end)&&(h=g.length-1));b.setSelections(g,h)})}function t(a,b){for(var c,d=Object.create(null),e=0;e<b.length;++e)c=b[e],(d[c.file]||(d[c.file]=[])).push(c);for(var f in d){var g=a.docs[f],h=d[f];if(g){h.sort(function(c,a){return M(a.start,c.start)});for(var c,i="*rename"+ ++L,e=0;e<h.length;++e)c=h[e],g.doc.replaceRange(c.text,c.start,c.end,i)}}}function u(a,b,c,d){var e=[],f=0,g=!c.fullDocs;g||delete c.fullDocs,"string"==typeof c&&(c={type:c}),c.lineCharPositions=!0,null==c.end&&(c.end=d||b.doc.getCursor("end"),b.doc.somethingSelected()&&(c.start=b.doc.getCursor("start")));var h=c.start||c.end;if(!b.changed)c.file=b.name;else if(b.doc.lineCount()>K&&!1!==g&&100>b.changed.to-b.changed.from&&b.changed.from<=h.line&&b.changed.to>c.end.line){e.push(v(b,h,c.end)),c.file="#0";var f=e[0].offsetLines;null!=c.start&&(c.start=I(c.start.line- -f,c.start.ch)),c.end=I(c.end.line-f,c.end.ch)}else e.push({type:"full",name:b.name,text:F(a,b)}),c.file=b.name,b.changed=null;for(var i in a.docs){var j=a.docs[i];j.changed&&j!=b&&(e.push({type:"full",name:j.name,text:F(a,j)}),j.changed=null)}return{query:c,files:e}}function v(b,c,d){for(var e,f=b.doc,g=null,h=null,i=4,j=c.line-1,k=H(0,j-50);j>=k;--j){var l=f.getLine(j),m=l.search(/\bfunction\b/);if(!(0>m)){var n=a.countColumn(l,null,i);null!=g&&g<=n||(g=n,h=j)}}null==h&&(h=k);var o=Math.min(f.lastLine(),d.line+20);if(null==g||g==a.countColumn(f.getLine(c.line),null,i))e=o;else for(e=d.line+1;e<o;++e){var n=a.countColumn(f.getLine(e),null,i);if(n<=g)break}var p=I(h,0);return{type:"part",name:b.name,offsetLines:p.line,text:f.getRange(p,I(e,d.line==e?null:0))}}function w(a,b){var c=document.createElement(a);b&&(c.className=b);for(var d,e=2;e<arguments.length;++e)d=arguments[e],"string"==typeof d&&(d=document.createTextNode(d)),c.appendChild(d);return c}function x(a,b,c){a.openDialog?a.openDialog(b+": <input type=text>",c):c(prompt(b,""))}function y(b,c,d){function f(){b.state.ternTooltip=null,g.parentNode&&C(g),j()}b.state.ternTooltip&&B(b.state.ternTooltip);var e=b.cursorCoords(),g=b.state.ternTooltip=A(e.right+1,e.bottom,c),h=!1,i=!1;a.on(g,"mousemove",function(){h=!0}),a.on(g,"mouseout",function(b){a.contains(g,b.relatedTarget||b.toElement)||(i?f():h=!1)}),setTimeout(function(){i=!0,h||f()},d.options.hintDelay?d.options.hintDelay:1700);var j=z(b,f)}function z(a,b){return a.on("cursorActivity",b),a.on("blur",b),a.on("scroll",b),a.on("setDoc",b),function(){a.off("cursorActivity",b),a.off("blur",b),a.off("scroll",b),a.off("setDoc",b)}}function A(a,b,c){var d=w("div",J+"tooltip",c);return d.style.left=a+"px",d.style.top=b+"px",document.body.appendChild(d),d}function B(a){var b=a&&a.parentNode;b&&b.removeChild(a)}function C(a){a.style.opacity="0",setTimeout(function(){B(a)},1100)}function D(a,b,c){a.options.showError?a.options.showError(b,c):y(b,c+"",a)}function E(a){a.activeArgHints&&(a.activeArgHints.clear&&a.activeArgHints.clear(),B(a.activeArgHints),a.activeArgHints=null)}function F(a,b){var c=b.doc.getValue();return a.options.fileFilter&&(c=a.options.fileFilter(c,b.name,b.doc)),c}function G(a){function d(a,b){b&&(a.id=++f,g[f]=b),e.postMessage(a)}var e=a.worker=new Worker(a.options.workerScript);e.postMessage({type:"init",defs:a.options.defs,plugins:a.options.plugins,scripts:a.options.workerDeps});var f=0,g={};e.onmessage=function(c){var e=c.data;"getFile"==e.type?b(a,e.name,function(a,b){d({type:"getFile",err:a+"",text:b,id:e.id})}):"debug"==e.type?window.console.log(e.message):e.id&&g[e.id]&&(g[e.id](e.err,e.body),delete g[e.id])},e.onerror=function(a){for(var b in g)g[b](a);g={}},this.addFile=function(a,b){d({type:"add",name:a,text:b})},this.delFile=function(a){d({type:"del",name:a})},this.request=function(a,b){d({type:"req",body:a},b)}}var H=Math.max;a.TernServer=function(a){var d=this;this.options=a||{};var c=this.options.plugins||(this.options.plugins={});c.doc_comment||(c.doc_comment=!0),this.docs=Object.create(null),this.server=this.options.useWorker?new G(this):new window.tern.Server({getFile:function(a,e){return b(d,a,e)},async:!0,defs:this.options.defs||[],plugins:c}),this.trackChange=function(a,b){e(d,a,b)},this.cachedArgHints=null,this.activeArgHints=null,this.jumpStack=[],this.getHint=function(a,b){return g(d,a,b)},this.getHint.async=!0},a.TernServer.prototype={addDoc:function(b,c){var d={doc:c,name:b,changed:null};return this.server.addFile(b,F(this,d)),a.on(c,"change",this.trackChange),this.docs[b]=d},delDoc:function(b){var d=c(this,b);d&&(a.off(d.doc,"change",this.trackChange),delete this.docs[d.name],this.server.delFile(d.name))},hideDoc:function(a){E(this);var b=c(this,a);b&&b.changed&&f(this,b)},complete:function(a){a.showHint({hint:this.getHint})},showType:function(a,b,d){i(this,a,b,"type",d)},showDocs:function(a,b,d){i(this,a,b,"documentation",d)},updateArgHints:function(a){j(this,a)},jumpToDef:function(a){m(this,a)},jumpBack:function(a){n(this,a)},rename:function(a){r(this,a)},selectName:function(a){s(this,a)},request:function(a,b,e,c){var f=this,g=d(this,a.getDoc()),h=u(this,g,b,c),i=h.query&&this.options.queryOptions&&this.options.queryOptions[h.query.type];if(i)for(var j in i)h.query[j]=i[j];this.server.request(h,function(a,c){!a&&f.options.responseFilter&&(c=f.options.responseFilter(g,b,h,a,c)),e(a,c)})},destroy:function(){E(this),this.worker&&(this.worker.terminate(),this.worker=null)}};var I=a.Pos,J="CodeMirror-Tern-",K=250,L=0,M=a.cmpPos});